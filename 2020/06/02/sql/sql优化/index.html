<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>简单的SQL优化 | Unique Craftsman</title><meta name="description" content="SQL优化基本面试点"><meta name="keywords" content="tag1,tag2,tag3"><meta name="author" content="小兔子乖乖"><meta name="copyright" content="小兔子乖乖"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon1.png"><link rel="canonical" href="www.dengjing520.cn/2020/06/02/sql/sql%E4%BC%98%E5%8C%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="简单的SQL优化"><meta property="og:url" content="www.dengjing520.cn/2020/06/02/sql/sql%E4%BC%98%E5%8C%96/"><meta property="og:site_name" content="Unique Craftsman"><meta property="og:description" content="SQL优化基本面试点"><meta property="og:image" content="www.dengjing520.cn/img/post/post8.jpg"><meta property="article:published_time" content="2020-06-02T07:30:16.000Z"><meta property="article:modified_time" content="2020-09-09T05:26:13.710Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: {"appId":"ZSC04LOBCX","apiKey":"34b7ba6cc72a096588854b65468c7d74","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isSidebar: true,
  postUpdate: '2020-09-09 13:26:13'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><script src="https://cdn.jsdelivr.net/gh/yremp/yremp-js@1.5/sakura.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">4</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%93%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">数据库专题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81SQL%E4%B9%A6%E5%86%99%E4%B8%93%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">一、SQL书写专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%83%B3%E5%88%B0%E6%9C%80%E6%99%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.想到最晚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8E%BB%E9%87%8D%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.去重关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%86%E9%A1%B5"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94-%E4%B8%BB%E8%A1%A8-join-%E4%BB%8E%E8%A1%A8-on-%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.多表关联   主表  join  从表 on 条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.5.</span> <span class="toc-text">5.多条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.1.6.</span> <span class="toc-text">6.sql执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%8A%95%E5%BD%B1%E6%9F%A5%E8%AF%A2%EF%BC%9A"><span class="toc-number">1.1.7.</span> <span class="toc-text">7.投影查询：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-group-by-%E5%88%86%E7%BB%84"><span class="toc-number">1.1.8.</span> <span class="toc-text">8.group by  分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-group-by-%E5%92%8C%E5%8E%BB%E9%87%8DDISTINCT%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="toc-number">1.1.9.</span> <span class="toc-text">9.group by 和去重DISTINCT有什么区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-group-by-%E5%92%8C%E5%8E%BB%E9%87%8DDISTINCT%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB-%E4%BA%8C%EF%BC%88%E6%95%88%E7%8E%87%E7%AF%87%EF%BC%89"><span class="toc-number">1.1.10.</span> <span class="toc-text">10.group by 和去重DISTINCT有什么区别 二（效率篇）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8A%A0%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87%E6%89%8D%E4%BC%9A%E6%98%BE%E8%91%97%E6%8F%90%E5%8D%87"><span class="toc-number">1.1.11.</span> <span class="toc-text">11.什么时候加索引效率才会显著提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6%EF%BC%8C%E9%82%A3%E4%B9%88%E9%A2%9D%E5%A4%96%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%80%8E%E4%B9%88%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.1.12.</span> <span class="toc-text">12.如果使用左外连接条件，那么额外的条件怎么拼接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E5%A6%82%E6%9E%9C%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E4%B8%AD%E8%AE%BE%E8%AE%A1%E4%B8%8D%E7%AD%89%E4%BA%8E"><span class="toc-number">1.1.13.</span> <span class="toc-text">13.如果条件查询中设计不等于</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81SQL%E4%BC%98%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text">二、SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E7%AF%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.索引篇</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E5%B9%B6%E4%BC%98%E5%8C%96%E6%85%A2%E6%9F%A5%E8%AF%A2SQL"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.如何定位并优化慢查询SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%A4%B1%E6%95%88"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 索引什么时候失效</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%9F%90%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8B%E7%B4%A2%E5%BC%95%E4%BC%9A%E5%A4%B1%E6%95%88"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">a.模糊查询的某种情况下索引会失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E5%A4%B1%E6%95%88%EF%BC%8C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E7%94%9F%E6%95%88"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">b.组合索引什么时候会失效，什么时候会生效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-%E5%A6%82%E6%9E%9C%E4%BD%A0%E7%9A%84sql%E9%87%8C%E9%9D%A2%E6%B6%89%E5%8F%8A%E5%88%B0-d-in-%EF%BC%88a-b-c%EF%BC%89%E4%B8%8D%E5%B1%9E%E4%BA%8E%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%EF%BC%8C%E5%B1%9E%E4%BA%8E%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">c.如果你的sql里面涉及到  d  in （a,b,c）不属于模糊查询，属于精确查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5-7%E4%B8%AA%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">d.索引失效的几种情况  7个索引失效</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-sql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.2.4.</span> <span class="toc-text">4.sql语句优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SELECT%E8%AF%AD%E5%8F%A5%E5%8A%A1%E5%BF%85%E6%8C%87%E6%98%8E%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0%E3%80%90%E4%B8%8D%E5%85%81%E8%AE%B8-select-%E3%80%91"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">(1) SELECT语句务必指明字段名称【不允许 select * 】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%94%A8TRUNCATE-%E4%BB%A3%E6%9B%BFDELETE"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">(2) 用TRUNCATE 代替DELETE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-SQL%E8%AF%AD%E5%8F%A5%E4%B8%ADIN%E5%8C%85%E5%90%AB%E7%9A%84%E5%80%BC%E4%B8%8D%E5%BA%94%E8%BF%87%E5%A4%9A"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">(3) SQL语句中IN包含的值不应过多</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%BD%93%E5%8F%AA%E9%9C%80%E8%A6%81%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%BF%E7%94%A8limit-1"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">(4)当只需要一条数据的时候，使用limit 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A6%82%E6%9E%9C%E6%8E%92%E5%BA%8F%E5%AD%97%E6%AE%B5%E6%B2%A1%E6%9C%89%E7%94%A8%E5%88%B0%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%B0%B1%E5%B0%BD%E9%87%8F%E5%B0%91%E6%8E%92%E5%BA%8F"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">(5)如果排序字段没有用到索引，就尽量少排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%BA%94%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E5%9C%A8-where-%E5%AD%90%E5%8F%A5%E4%B8%AD%E4%BD%BF%E7%94%A8-%E6%88%96-lt-gt-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">(6)应尽量避免在 where 子句中使用 !&#x3D; 或 &lt;&gt; 操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-limit-%E4%BC%98%E5%8C%96%E3%80%82%E4%BD%BF%E7%94%A8%E5%90%88%E7%90%86%E7%9A%84%E5%88%86%E9%A1%B5%E6%96%B9%E5%BC%8F%E4%BB%A5%E6%8F%90%E9%AB%98%E5%88%86%E9%A1%B5%E7%9A%84%E6%95%88%E7%8E%87"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">(7)limit 优化。使用合理的分页方式以提高分页的效率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E6%B3%A8%E6%84%8F%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.4.8.</span> <span class="toc-text">(8)注意范围查询语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%B0%BD%E9%87%8F%E4%BD%BF%E7%94%A8inner-join%EF%BC%8C%E9%81%BF%E5%85%8Dleft-join%EF%BC%9A"><span class="toc-number">1.2.4.9.</span> <span class="toc-text">(9)尽量使用inner  join，避免left join：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E8%80%83%E8%99%91%E5%9C%A8-where-%E5%8F%8A-order-by-%E6%B6%89%E5%8F%8A%E7%9A%84%E5%88%97%E4%B8%8A%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E3%80%82"><span class="toc-number">1.2.4.10.</span> <span class="toc-text">(10)考虑在 where 及 order by 涉及的列上建立索引。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%AE%80%E5%8D%95%E5%BE%AA%E7%8E%AF%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.5.</span> <span class="toc-text">5.简单循环存储过程</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/post/post8.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Unique Craftsman</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">简单的SQL优化</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-06-02T07:30:16.000Z" title="发表于 2020-06-02 15:30:16">2020-06-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-09-09T05:26:13.710Z" title="更新于 2020-09-09 13:26:13">2020-09-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="数据库专题"><a href="#数据库专题" class="headerlink" title="数据库专题"></a>数据库专题</h1><h2 id="一、SQL书写专题"><a href="#一、SQL书写专题" class="headerlink" title="一、SQL书写专题"></a>一、SQL书写专题</h2><h3 id="1-想到最晚"><a href="#1-想到最晚" class="headerlink" title="1.想到最晚"></a>1.想到最晚</h3><pre><code class="JAVA">a.排序   降序排序   时间最大的就是最晚

b.“MAX” “MIN”     聚合函数</code></pre>
<h3 id="2-去重关键字"><a href="#2-去重关键字" class="headerlink" title="2.去重关键字"></a>2.去重关键字</h3><p>​    DISTINCT</p>
<h3 id="3-分页"><a href="#3-分页" class="headerlink" title="3.分页"></a>3.分页</h3><p>​    mysql：LIMIT 2,1<br>​    oracle : rownum<br>​    区别对比链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xu-cceed3w/p/8824199.html">https://www.cnblogs.com/xu-cceed3w/p/8824199.html</a></p>
<h3 id="4-多表关联-主表-join-从表-on-条件"><a href="#4-多表关联-主表-join-从表-on-条件" class="headerlink" title="4.多表关联   主表  join  从表 on 条件"></a>4.多表关联   主表  join  从表 on 条件</h3><p>​       左外关联   left  join  on    把左边的表当做主表  右边的表可以有空值<br>​       右外关联   right join  on    把右边的表当做主表  左边的表可以有空值     </p>
<h3 id="5-多条件查询"><a href="#5-多条件查询" class="headerlink" title="5.多条件查询"></a>5.多条件查询</h3><p>​    where  + 条件  and  条件 </p>
<h3 id="6-sql执行顺序"><a href="#6-sql执行顺序" class="headerlink" title="6.sql执行顺序"></a>6.sql执行顺序</h3><pre><code>–第一步：执行FROM            select * from student 

–第二步：WHERE条件过滤        select * from student   where id = 1;

–第三步：GROUP BY分组        

–第四步：执行SELECT投影列，聚合函数    投影查询：select  id ,name ,score from student where id = 1

–第五步：HAVING条件过滤

–第六步：执行ORDER BY 排序</code></pre>
<p>敢死队：SELECT emp_no  ,count(emp_no) t from salaries s  </p>
<p>法师：   GROUP BY s.emp_no HAVING  t &gt; 0  </p>
<p>护卫军： ORDER BY t </p>
<h3 id="7-投影查询："><a href="#7-投影查询：" class="headerlink" title="7.投影查询："></a>7.投影查询：</h3><pre><code class="JAVA">使用SELECT * FROM &lt;表名&gt; WHERE &lt;条件&gt;可以选出表中的若干条记录。我们注意到返回的二维表结构和原表是相同的，即结果集的所有列与原表的所有列都一一对应。

如果我们只希望返回某些列的数据，而不是所有列的数据，我们可以用SELECT 列1, 列2, 列3 FROM ...，让结果集仅包含指定列。这种操作称为投影查询。

例如，从students表中返回id、score和name这三列：</code></pre>
<h3 id="8-group-by-分组"><a href="#8-group-by-分组" class="headerlink" title="8.group by  分组"></a>8.group by  分组</h3><p>​    一般group by和聚合函数一起使用<br>​    例：全班按照男女生进行分组检查人数，select 性别，count（id） from student group by 性别</p>
<h3 id="9-group-by-和去重DISTINCT有什么区别"><a href="#9-group-by-和去重DISTINCT有什么区别" class="headerlink" title="9.group by 和去重DISTINCT有什么区别"></a>9.group by 和去重DISTINCT有什么区别</h3><p>​    1.去重：数据去重    去重之后数据会丢失，只留排序的第一条<br>​    2.group by ：数据分组     分组之后数据未丢失，还存在，可以使用聚合函数进行计算   </p>
<h3 id="10-group-by-和去重DISTINCT有什么区别-二（效率篇）"><a href="#10-group-by-和去重DISTINCT有什么区别-二（效率篇）" class="headerlink" title="10.group by 和去重DISTINCT有什么区别 二（效率篇）"></a>10.group by 和去重DISTINCT有什么区别 二（效率篇）</h3><p>group by效率高   </p>
<pre><code>原因：DISTINCT去重的原理，全表扫描，并且全部遍历去重，数据量小的时候效率高，数据量大就疯了
     group by 原理：是先创建索引，然后才进行分组 
【如果某一个字段未加索引例如：name字段未加索引，对name = 123当做条件进行查询，如果数据量大就会GG ，用户很不满意】  B+树索引 mysql</code></pre>
<h3 id="11-什么时候加索引效率才会显著提升"><a href="#11-什么时候加索引效率才会显著提升" class="headerlink" title="11.什么时候加索引效率才会显著提升"></a>11.什么时候加索引效率才会显著提升</h3><p>数据重复率越底，加索引效率越高（性别：F M   0  1）   加索引也没用，不能形成树形结构  </p>
<pre><code class="JAVA">数据量小的表不需要建立索引，建立会增加额外的索引开销。                            
数据变更需要维护索引，因此更多的索引意味着更多的维护成本。
更多的索引意味着也需要更多的空间。

索引的选择性是指索引列中不同值的数目与表中记录数的比。
如果一个表中有2000条记录，表索引列有1980个不同的值，那么这个 【索引的选择性】就是1980/2000=0.99。一个索引的选择性越接近于1，这个索引的效率就越高。</code></pre>
<h3 id="12-如果使用左外连接条件，那么额外的条件怎么拼接"><a href="#12-如果使用左外连接条件，那么额外的条件怎么拼接" class="headerlink" title="12.如果使用左外连接条件，那么额外的条件怎么拼接"></a>12.如果使用左外连接条件，那么额外的条件怎么拼接</h3><pre><code class="java">SELECT * from employees e left join  dept_emp d  on e.emp_no = d.emp_no where d.dept_no is  null
额外的条件使用where连接</code></pre>
<h3 id="13-如果条件查询中设计不等于"><a href="#13-如果条件查询中设计不等于" class="headerlink" title="13.如果条件查询中设计不等于"></a>13.如果条件查询中设计不等于</h3><p>使用符号  &lt;&gt;</p>
<h2 id="二、SQL优化"><a href="#二、SQL优化" class="headerlink" title="二、SQL优化"></a>二、SQL优化</h2><h3 id="1-索引篇"><a href="#1-索引篇" class="headerlink" title="1.索引篇"></a>1.索引篇</h3><pre><code class="java">1.添加PRIMARY KEY(主键索引)
alter table `table_name` add primary key(`column`);

2.添加UNIQUE(唯一索引)
alter table `table_name` add unique(`column`);

3.添加普通索引
alter table `table_name` add index index_name(`column`);

4.添加全文索引（了解）
alter table `table_name` add fulltext(`column`);

5.添加多列索引
alter table `table_name` add index index_name(`column1`,`column2`,`column3`);

MySQL数据库的索引分类
主键索引：它是一种特殊的唯一索引，不允许有空值。一般是在建表的时候同时创建主键索引。
普通索引(Normal)：最基本的MySQL数据库索引，它没有任何限制。
唯一索引(Unique)：它与普通索引类似，不同的就是：MySQL数据库索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。
全文索引(Full Text ):  全文索引可以在varchar、char、text类型的列上创建。
空间索引(SPATIAL):空间索引是对空间数据类型的字段建立的索引,空间索引只能在存储引擎为myISAM的表中创建</code></pre>
<h3 id="2-如何定位并优化慢查询SQL"><a href="#2-如何定位并优化慢查询SQL" class="headerlink" title="2.如何定位并优化慢查询SQL"></a>2.如何定位并优化慢查询SQL</h3><pre><code>根据慢日志定位慢查询SQL               //最好是修改

show variables like &#39;%quer%&#39;;      // 查看MySQL服务器配置信息。
show status like &#39;slow_queries&#39;;    // 查看查询时间超过long_query_time秒的查询的个数。
set global slow_query_log=on;    //将慢日志设置打开
set global long_query_time=1;    //将慢日志的查询时间定到1秒,需要重新连接数据库
my.ini  重启mysqls
slow_query_log=ON
slow_query_log_file=F:/2.mysql/slow.log
long_query_time=1            
使用explain等工具分析SQL

    添加索引
    ALTER TABLE tb_menu ADD INDEX parent_id(parent_id);
    explain命令查看一个这些SQL语句的执行计划，查看该SQL语句有没有使用上了索引，有没有做全表扫描
    explain select 字段名 from 表名 order by 字段名 desc;

    explain关键字段：    
    type：
        system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all
        all  (出现这个参数,说明,本语句需要优化)

对表访问方式，表示MySQL在表中找到所需行的方式，又称“访问类型”。
常用的类型有： ALL、index、range、 ref、eq_ref、const、system、NULL（从左到右，性能从差到好）

ALL：Full Table Scan， MySQL将遍历全表以找到匹配的行

index: Full Index Scan，index与ALL区别为index类型只遍历索引树

range:只检索给定范围的行，使用一个索引来选择行

ref: 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值

eq_ref: 类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件

const、system: 当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量，system是const类型的特例，当查询的表只有一行的情况下，使用system

NULL: MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</code></pre>
<pre><code>        extra:  出现以下两项意味着MySQL根本不能使用索引。
        Using filesort：MySQL中无法利用索引完成的排序操作称为“文件排序”。 mysql使用外部索引排序,可能是在内存或者磁盘进行排序,并不是在表中.
        Using temporary：表示MySQL在对查询结果排序时使用临时表。常见的是使用order by和group by

    友情链接：https://www.cnblogs.com/tufujie/p/9413852.html


</code></pre>
<pre><code class="JAVA">数据库批量插入垃圾数据脚本【存储过程】
创建存储过程
DROP PROCEDURE IF EXISTS add_student;  
DELIMITER //
   create PROCEDURE add_student(in num INT)
   BEGIN
       DECLARE rowid INT DEFAULT 0;
       DECLARE firstname CHAR(1);
       DECLARE name1 CHAR(1);
       DECLARE name2 CHAR(1);
       DECLARE lastname VARCHAR(3) DEFAULT &#39;&#39;;
       DECLARE sex CHAR(1);
       DECLARE score INT DEFAULT 0;
       DECLARE updateFirstName  CHAR(1);
       DECLARE updateLastName CHAR(1);
       DECLARE updateScore INT DEFAULT 0;
       SET @exedata = &quot;&quot;;
       WHILE rowid &lt; num DO
           SET firstname = SUBSTRING(&#39;赵钱孙李周吴郑王林杨柳刘孙陈江阮侯邹高彭徐&#39;,FLOOR(1+21*RAND()),1); 
           SET name1 = SUBSTRING(&#39;一二三四五六七八九十甲乙丙丁静景京晶名明铭敏闵民军君俊骏天田甜兲恬益依成城诚立莉力黎励&#39;,floor(1+43*RAND()),1); 
           SET name2 = SUBSTRING(&#39;一二三四五六七八九十甲乙丙丁静景京晶名明铭敏闵民军君俊骏天田甜兲恬益依成城诚立莉力黎励&#39;,floor(1+43*RAND()),1); 
           SET sex=SUBSTRING(&#39;男女&#39;,floor(1+2*RAND()),1);
           SET score= FLOOR(40 + (RAND() *60));
           SET lastname=SUBSTRING(&#39;一二三四五六七八九十甲乙丙丁静景京晶名明铭敏闵民军君俊骏天田甜雨恬益依娥我他刚人发上乐&#39;,floor(1+43*RAND()),1);
           SET rowid = rowid + 1;
           IF ROUND(RAND())=0 THEN 
           SET lastname =name1;
           END IF;
           IF ROUND(RAND())=1 THEN
           SET lastname = CONCAT(name1,name2);
           END IF;
           IF length(@exedata)&gt;0 THEN
           SET @exedata = CONCAT(@exedata,&#39;,&#39;);
           END IF;
           SET @exedata=concat(@exedata,&quot;(&#39;&quot;,firstname,&quot;&#39;,&#39;&quot;,lastname,&quot;&#39;,&#39;&quot;,sex,&quot;&#39;,&#39;&quot;,score,&quot;&#39;)&quot;);
           IF rowid%10000=0
           THEN 
               SET @exesql =concat(&quot;insert into student(first_name,last_name,sex,score) values &quot;, @exedata);
               prepare stmt from @exesql;
               execute stmt;
               DEALLOCATE prepare stmt;
               SET @exedata = &quot;&quot;;
           END IF;
       END WHILE;

       IF length(@exedata)&gt;0 
       THEN
           SET @exesql =concat(&quot;insert into student(first_name,last_name,sex,score) values &quot;, @exedata);
           prepare stmt from @exesql;
           execute stmt;
           DEALLOCATE prepare stmt;
       END IF; 
   END //
DELIMITER ;</code></pre>
<p>执行存储过程：</p>
<pre><code>执行存储过程插入100万条数据
    call add_user(1000000);
</code></pre>
<h3 id="3-索引什么时候失效"><a href="#3-索引什么时候失效" class="headerlink" title="3. 索引什么时候失效"></a>3. 索引什么时候失效</h3><h4 id="a-模糊查询的某种情况下索引会失效"><a href="#a-模糊查询的某种情况下索引会失效" class="headerlink" title="a.模糊查询的某种情况下索引会失效"></a>a.模糊查询的某种情况下索引会失效</h4><pre><code class="java">如果模糊查询%在左边，索引会失效
EXPLAIN SELECT * from student s where  s.last_name like &#39;%铭&#39;

如果模糊查询%在右边，索引会生效
EXPLAIN SELECT * from student s where  s.last_name like &#39;铭%&#39;</code></pre>
<h4 id="b-组合索引什么时候会失效，什么时候会生效"><a href="#b-组合索引什么时候会失效，什么时候会生效" class="headerlink" title="b.组合索引什么时候会失效，什么时候会生效"></a>b.组合索引什么时候会失效，什么时候会生效</h4><pre><code class="java">联合索引概念：
    多个字段组合成一个索引  a ， b ，c

联合索引的最左前缀匹配原则的成因
    在A B两个字段建立联合索引，where A B   走联合索引，where B A   走联合索引，where A   走联合索引，where B  不走联合索引。
最左前缀匹配原则，MySQL会一直向右匹配直到遇到范围查询（&gt; &lt; between like）就停止匹配。=和in可以乱序，MySQL的查询优化器会帮你优化成索引可以识别的形式。

联合索引先对第一个字段进行排序，所以一个字段是绝对有序的，然后才会对第二个字段进行排序。
alter table users2 add index userName_password(userName,password);

联合索引最左边的字段是B+树中的关键字节点。

结论：如果碰到联合索引，查询条件中一定要包含联合索引最左边的字段，否则联合索引不生效。
    前提一定是要精确查询  in 和 and 一定没有问题精确查询
    模糊查询 like  %铭 失效  
    待考证：between

友情链接：https://blog.csdn.net/qq_16557637/article/details/94324296【23 24答案写反了】</code></pre>
<h4 id="c-如果你的sql里面涉及到-d-in-（a-b-c）不属于模糊查询，属于精确查询"><a href="#c-如果你的sql里面涉及到-d-in-（a-b-c）不属于模糊查询，属于精确查询" class="headerlink" title="c.如果你的sql里面涉及到  d  in （a,b,c）不属于模糊查询，属于精确查询"></a>c.如果你的sql里面涉及到  d  in （a,b,c）不属于模糊查询，属于精确查询</h4><h4 id="d-索引失效的几种情况-7个索引失效"><a href="#d-索引失效的几种情况-7个索引失效" class="headerlink" title="d.索引失效的几种情况  7个索引失效"></a>d.索引失效的几种情况  7个索引失效</h4><p>1、不要在查询中使用 !=、not in、not exists</p>
<pre><code class="java">SELECT * FROM goods WHERE STATUS != 0

可优化为：

SELECT * FROM goods WHERE STATUS = 1 OR STATUS = 2

由于在使用not in时，MySQL会进行全表扫描而不利用索引，因为MySQL认为使用索引反而更麻烦。比如，从 1000 个人中把编号为145、761 这两个学生之外的所有学生资料抄写一遍。你是先找出这两个学生的成绩放一边儿，然后再开始抄写，还是直接开始一份挨一份抄写，看到这两个号直接跳过去？
</code></pre>
<p>2、不要在where条件的等号左侧中使用函数</p>
<pre><code class="java">SELECT * FROM goods WHERE YEAR (time) &gt; = &#39;2017&#39;

可优化为：

SELECT * FROM goods WHERE time &gt; = &#39;2017-01-01&#39;

对于带有列的函数计算，MySQL是无法使用索引的（Oracle可以使用函数索引）。在使用函数时，如SUBSTR函数，将&#39;apple&#39;更改为了&#39;app&#39;，此时值发生了改变，导致之前设置的索引无效。
</code></pre>
<p> 3、MySQL支持前缀索引，但是不支持后缀索引【普通索引】</p>
<p>作业：<strong>把普通索引修改为全文索引，看看走不走索引：</strong></p>
<pre><code class="java">CREATE FULLTEXT INDEX idx_info ON student(last_name);
SELECT * FROM goods WHERE NAME LIKE &#39;%A&#39;

可优化为：
SELECT * FROM goods WHERE NAME LIKE &#39;A%&#39;
</code></pre>
<p>全文索引使用:【分词，倒序排序】搜索引擎 ES</p>
<pre><code class="java">使用全文索引
     跟普通索引稍有不同
     使用全文索引的格式：  MATCH (columnName) AGAINST (&#39;string&#39;)
     eg:
           SELECT last_name from student  where  MATCH (last_name) AGAINST (&#39;铭&#39;)
      当查询多列数据时：
      建议在此多列数据上创建一个联合的全文索引，否则使用不了索引的。

 SELECT * FROM `student` WHERE MATCH(`name`,`address`) AGAINST(&#39;聪 广东&#39;)</code></pre>
<p>*** 4、设置联合索引时，索引的建立顺序要和where或者order by条件中的字段顺序相同，如建立name、status（分别为key1、key2）的联合索引，此时以name字段为第一查询顺序的索引有效：</p>
<pre><code class="java">SELECT * FROM goods WHERE NAME = &#39;A&#39; AND STATUS = 0

SELECT * FROM goods WHERE NAME = &#39;A&#39; 

但以STATUS开头的查询索引都会失效：

SELECT * FROM goods WHERE STATUS = 0 AND NAME=&#39;A&#39;

SELECT * FROM goods WHERE STATUS = 0</code></pre>
<p>*** 5、where条件中有or，需将or中的每个字段都加上索引</p>
<p><strong>作业：如果换成and 索引失效情况</strong></p>
<pre><code class="java">SELECT * FROM goods WHERE NAME = &#39;A&#39; OR STATUS = 0

若仅设置 name 或 status 其中一个字段为索引，索引无效。</code></pre>
<p>6、状态值少的字段不宜使用索引</p>
<pre><code class="java">例如索引列 sex 字段有2个状态值，如果有10w条数据，那么where sex = 0 将访问表中的 5w个数据块，再加上访问索引块，一共要访问大于 5w个的数据块。如果全表扫描，假设10条数据一个数据块，只需访问 1w个数据块，此时全表扫描比利用索引效率更高，因此对于状态值很少的列，不适合建立索引。</code></pre>
<p><strong>索引的选择性</strong></p>
<pre><code class="java">索引的选择性是指索引列中不同值的数目与表中记录数的比。
如果一个表中有2000条记录，表索引列有1980个不同的值，那么这个索引的选择性就是1980/2000=0.99。一个索引的选择性越接近于1，这个索引的效率就越高

主键： 1万条数据，      1 

性别： 2/1万=0.00005
</code></pre>
<p>*** 7、数据类型不匹配</p>
<pre><code class="java">当索引列的数据类型为字符型，按照数字查询会导致索引失效：
SELECT * FROM goods WHERE card = 1234567890

可更改为：
SELECT * FROM goods WHERE card = &#39;1234567890&#39;

通常情况下，当我们为字符类型的字段赋值时需要加入单引号，但是如果把一个纯数字的字符串赋值给一个字符型的字段时，可以不用加单引号，因为此时数据库系统会自动把这串数字转换为字符型数据。但当我们进行查询（where 条件中包含索引字段）时，如果采用纯数字，数据库会采用全表扫描，而非引用索引。我个人的理解是，可以将引号看做是一种函数，失效原因则与在 where条件左侧使用函数导致索引失效的原理相同。
</code></pre>
<h3 id="4-sql语句优化"><a href="#4-sql语句优化" class="headerlink" title="4.sql语句优化"></a>4.sql语句优化</h3><p>**sql 优化     5个；   sql优化      34个    20个</p>
<p>数据库表结构优化 【业务】</p>
<p>**架构优化  【一个数据库，user，分表  ，多个数据库】</p>
<h4 id="1-SELECT语句务必指明字段名称【不允许-select-】"><a href="#1-SELECT语句务必指明字段名称【不允许-select-】" class="headerlink" title="(1) SELECT语句务必指明字段名称【不允许 select * 】"></a>(1) SELECT语句务必指明字段名称【不允许 select * 】</h4><pre><code class="java">SELECT*增加很多不必要的消耗（CPU、IO、内存、网络带宽）；增加了使用覆盖索引的可能性；当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。</code></pre>
<h4 id="2-用TRUNCATE-代替DELETE"><a href="#2-用TRUNCATE-代替DELETE" class="headerlink" title="(2) 用TRUNCATE 代替DELETE"></a>(2) 用TRUNCATE 代替DELETE</h4><h4 id="3-SQL语句中IN包含的值不应过多"><a href="#3-SQL语句中IN包含的值不应过多" class="headerlink" title="(3) SQL语句中IN包含的值不应过多"></a>(3) SQL语句中IN包含的值不应过多</h4><pre><code class="java">MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用between就不要用in了；再或者使用连接来替换。</code></pre>
<h4 id="4-当只需要一条数据的时候，使用limit-1"><a href="#4-当只需要一条数据的时候，使用limit-1" class="headerlink" title="(4)当只需要一条数据的时候，使用limit 1"></a>(4)当只需要一条数据的时候，使用limit 1</h4><pre><code class="java">这是为了使EXPLAIN中type列达到const类型</code></pre>
<h4 id="5-如果排序字段没有用到索引，就尽量少排序"><a href="#5-如果排序字段没有用到索引，就尽量少排序" class="headerlink" title="(5)如果排序字段没有用到索引，就尽量少排序"></a>(5)如果排序字段没有用到索引，就尽量少排序</h4><h4 id="6-应尽量避免在-where-子句中使用-或-lt-gt-操作符"><a href="#6-应尽量避免在-where-子句中使用-或-lt-gt-操作符" class="headerlink" title="(6)应尽量避免在 where 子句中使用 != 或 &lt;&gt; 操作符"></a>(6)应尽量避免在 where 子句中使用 != 或 &lt;&gt; 操作符</h4><pre><code class="java">否则将导致引擎放弃使用索引而进行全表扫描。
SQL中，不等于操作符会限制索引，引起全表扫描，即使比较的字段上有索引。</code></pre>
<h4 id="7-limit-优化。使用合理的分页方式以提高分页的效率"><a href="#7-limit-优化。使用合理的分页方式以提高分页的效率" class="headerlink" title="(7)limit 优化。使用合理的分页方式以提高分页的效率"></a>(7)limit 优化。使用合理的分页方式以提高分页的效率</h4><pre><code class="java">使用下面SQL语句做分页的时候，可能有人会发现，随着表数据量的增加，直接使用limit分页查询会越来越慢。
select id,name from product 
limit 89757, 20</code></pre>
<p>优化的方法如下：</p>
<pre><code class="java">可以取前一页的最大行数的id，然后根据这个最大的id来限制下一页的起点。比如此列中，上一页最大的 id 是89756。</code></pre>
<p>SQL可以采用如下的写法： b+树的特性【指针链】</p>
<pre><code class="JAVA">select id,name from product 
where id&gt; 89756 
limit 20</code></pre>
<h4 id="8-注意范围查询语句"><a href="#8-注意范围查询语句" class="headerlink" title="(8)注意范围查询语句"></a>(8)注意范围查询语句</h4><p>思考：【使用in会索引失效么】 一般不会 ，如果in的多了可能就失效了</p>
<p>​    一般来说：如果使用or 连接条件，尽量不要超过5个。否则可能索引失效；</p>
<pre><code class="java">对于联合索引来说，如果存在范围查询，比如between、&gt;、&lt;等条件时，会造成后面的索引字段失效。 </code></pre>
<h4 id="9-尽量使用inner-join，避免left-join："><a href="#9-尽量使用inner-join，避免left-join：" class="headerlink" title="(9)尽量使用inner  join，避免left join："></a>(9)尽量使用inner  join，避免left join：</h4><p> 参与联合查询的表至少为2张表，一般都存在大小之分。如果连接方式是inner  join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表；但是left  join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。</p>
<h4 id="10-考虑在-where-及-order-by-涉及的列上建立索引。"><a href="#10-考虑在-where-及-order-by-涉及的列上建立索引。" class="headerlink" title="(10)考虑在 where 及 order by 涉及的列上建立索引。"></a>(10)考虑在 where 及 order by 涉及的列上建立索引。</h4><pre><code class="java">因地制宜，根据实际情况进行调整，因为有时索引太多也会降低性能。
order by的列尽量被索引。order by的列如果被索引，性能也会更好</code></pre>
<h3 id="5-简单循环存储过程"><a href="#5-简单循环存储过程" class="headerlink" title="5.简单循环存储过程"></a>5.简单循环存储过程</h3><pre><code class="java">-- repeat 循环
  /*repeat 循环语法
  repeat
      循环体
  until 条件 end repeat;
  */


  -- 实例；
DROP PROCEDURE IF EXISTS sum55; 
DELIMITER //
create procedure sum55(a int)
  begin
      declare i int DEFAULT 0;

       repeat -- 循环开始
        insert  into `user`(`name`,`gender`,`age`,`address`,`qq`,`email`) values (&#39;张三&#39;,&#39;男&#39;,13,&#39;陕西&#39;,&#39;12345&#39;,&#39;zhangsan@itcast.cn&#39;);
                        insert  into `user`(`name`,`gender`,`age`,`address`,`qq`,`email`) values (&#39;李四&#39;,&#39;女&#39;,15,&#39;北京&#39;,&#39;88888&#39;,&#39;ls@itcast.cn&#39;);

           set i=i+1;
       until i&gt;a end repeat; -- 循环结束
  end
    //
DELIMITER ;</code></pre>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小兔子乖乖</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="/www.dengjing520.cn/2020/06/02/sql/sql%E4%BC%98%E5%8C%96/">www.dengjing520.cn/2020/06/02/sql/sql%E4%BC%98%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="www.dengjing520.cn" target="_blank">Unique Craftsman</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tag1/">tag1</a><a class="post-meta__tags" href="/tags/tag2/">tag2</a><a class="post-meta__tags" href="/tags/tag3/">tag3</a></div><div class="post_share"><div class="social-share" data-image="/img/post/post8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/pay/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/pay/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/09/17/SomeNewPost/"><img class="prev-cover" src="/img/post/post5.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Some New Post</div></div></a></div><div class="next-post pull-right"><a href="/2020/05/02/redis/redis%E7%AC%94%E8%AE%B0%20-%20%E6%89%A9%E5%B1%95/"><img class="next-cover" src="/img/post/post4.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Redis学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/05/02/redis/redis笔记 - 扩展/" title="Redis学习笔记"><img class="cover" src="/img/post/post4.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-02</div><div class="title">Redis学习笔记</div></div></a></div><div><a href="/2019/12/07/server/Tomcat优化 /" title="少许Tomcat基本优化点"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-07</div><div class="title">少许Tomcat基本优化点</div></div></a></div><div><a href="/2019/12/02/小的知识点/" title="编程日记"><img class="cover" src="/img/post/post.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-02</div><div class="title">编程日记</div></div></a></div><div><a href="/2019/12/02/sql/01.事务/" title="数据库事务"><img class="cover" src="/img/post/post2.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-02</div><div class="title">数据库事务</div></div></a></div><div><a href="/2019/12/02/life/live/写给自己的总结/" title="重新开始用心记录每一个遇到的问题"><img class="cover" src="/img/post/post7.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-02</div><div class="title">重新开始用心记录每一个遇到的问题</div></div></a></div><div><a href="/2019/12/02/life/live/愚蠢日记/" title="愚蠢日记"><img class="cover" src="/img/post/post1.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-02</div><div class="title">愚蠢日记</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(/img/post/post8.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By 小兔子乖乖</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/algolia.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script></div></body></html>